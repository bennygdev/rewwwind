{% extends "dashboard/base.html" %}
{% set active_page = "manage_products" %}
{% block styles %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/pageInteractions/filters.css') }}">
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/dashboard/manageProducts/productListing.css') }}">
{% endblock %}
{% block title %}Manage Products{% endblock %}


{% block content %}
<div class="header">
    <div class="header__left">
        <h2>Manage Products</h2>
        <div class="filters">
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
            <div class="filter-container">
                <label>Type</label>
                <div class="filter">
                    <span class="selected">All</span>&nbsp;&nbsp;<i class="bi bi-chevron-down"></i>
                    <ul class="filter--options">
                        <li class="highlighted">All</li>
                        <li>short</li>
                        <li>mediuuum</li>
                        <li>looooooooong</li>
                    </ul>
                </div>
            </div>
          </div>
    </div>
    <div class="header__right">
        <div><h5><i class="bi bi-gift-fill"></i>{{ products|length }} Total Products</h5></div>
        <a href='/dashboard/manage-products/add-product'><h3><i class="fa-solid fa-plus"></i>Add Product</h3></a>
    </div>
</div>
<div class="nav__search-container">
    <input type="text" id="nav__search-bar" class="nav__search-bar" placeholder="Search..." autocomplete="off">
    <i class="fa-solid fa-magnifying-glass nav__search-button" id="nav__search-button"></i>
    <div id="nav__search--suggestions" class="nav__search--suggestions"></div>
  </div>
<div class="products">
    <table>
        <thead>
            <tr>
                <th class="productName">Name</th>
                <th class="productType">Type</th>
                <th class="productGenre">Genre</th>
                <th class="productVariants">Variants</th>
                <th class="productAvgPrice">Avg. Price</th>
                <th class="productStock"></th>
                <th class="controls"></th>
            </tr>
        </thead>
        {% for product in products %}
        <tr product-id="{{ product.id }}">
            <td class="productName">
                <div class="thumbnail"><img src="{{ url_for('static', filename=product.image_thumbnail) }}" alt="{{ product.name }}"/></div>
                <div class="name"><p>{{ product.name }}</p><p>ID: {{ product.id }}</p></div>
            </td>
            <td class="productType">{{ product.category.category_name }}</td>
            <td class="productGenre">{{ product.category.category_name }}</td>
            <td class="productVariants">{{ product.variants|length }}</td>
            <td class="productAvgPrice">&dollar;{{ '{:.2f}'.format(product.variants[0].price) }}</td>
            {% if product.variants[0].stock == 0 %}
                {% set stock_class = 'noStock' %}
                {% set stock_text = 'Out of stock' %}
            {% elif product.variants[0].stock <= 10 %}
                {% set stock_class = 'lowStock' %}
                {% set stock_text = 'Low on stock' %}
            {% else %}
                {% set stock_class = 'highStock' %}
                {% set stock_text = 'High stock' %}
            {% endif %}
            <td class="productStock {{ stock_class }}">
                <div>{{ stock_text }}</div>
            </td>
            <td class="controls">
                <div>
                    <i class="bi bi-pencil-square"></i>
                    <a href="/products/product/{{ product.id }}"><i class="bi bi-eye-fill"></i></a>
                    <i class="bi bi-trash-fill"></i>
                </div>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>
<div class="overlay"></div>
{% if deleteForm.deleteConfirm.errors or deleteForm.deleteConfirm.data == 'success' %}
    {% set display = 'flex' %}
{% else %}
    {% set display = 'none' %}
{% endif %}
<div class="delete__form-container {{ deleteForm.deleteConfirm.data }}" id="{{ deleteForm.productID.data }}" style="display: {{ display }};"> <!-- if you're getting an error for this, don't mind it. vscode just assumes it as plain html rather than jinja, but when you run it the jinja template will still be processed -->
    <i class="bi bi-x-lg"></i>
    {% if deleteForm.deleteConfirm.data == 'success' %}
        <div class="header">
            <i class="bi bi-check-circle"></i>
            <h2>The product has been removed successfully.</h2>
        </div>
        <div class="product" style="display: none;"></div>
        <form class="delete__form" method="POST" action="{{ url_for('manageProducts.delete_product') }}">
            {{ deleteForm.hidden_tag() }}
            
            <div class="delete__modal">
                {{ deleteForm.productID() }}
                {{ deleteForm.deleteConfirm(class='form-control', placeholder='Type CONFIRMDELETE to confirm deletion', style="display: none;") }}
                {% if deleteForm.deleteConfirm.errors %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert" style="display: none;">
                        {% for error in deleteForm.deleteConfirm.errors %}
                            {{ error }}
                        {% endfor %}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endif %}

                <div class="buttons">
                    <div class="cancel_button button__wrapper">
                        <input type="button" value="Exit">
                    </div>
                    <div class="delete_button button__wrapper" style="display: none;">
                        {{ deleteForm.submit() }}
                    </div>  
                </div>                    
            </div>
        </form>
    {% else %}
        <div class="header">
            <i class="bi bi-exclamation-circle"></i>
            <h2>You are about to delete the following product</h2>
            <span>This action <b>cannot be undone</b> once performed.</span>
        </div>
        <div class="product"></div>
        <form class="delete__form" method="POST" action="{{ url_for('manageProducts.delete_product') }}">
            {{ deleteForm.hidden_tag() }}
            
            <div class="delete__modal">
                {{ deleteForm.productID() }}
                {{ deleteForm.deleteConfirm(class='form-control', placeholder='Type CONFIRMDELETE to confirm deletion') }}
                {% if deleteForm.deleteConfirm.errors %}
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        {% for error in deleteForm.deleteConfirm.errors %}
                            {{ error }}
                        {% endfor %}
                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                    </div>
                {% endif %}

                <div class="buttons">
                    <div class="cancel_button button__wrapper">
                        <input type="button" value="Cancel">
                    </div>
                    <div class="delete_button button__wrapper">
                        {{ deleteForm.submit() }}
                    </div>  
                </div>                    
            </div>
        </form>
    {% endif %}
</div>
{% endblock %}

{% block body_scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='js/pageInteractions/filters.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dashboard/manageProducts/deleteProduct.js') }}"></script>
{% endblock %}