{% extends "views/base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/tradein/custTradeDetails.css') }}">
{% endblock %}




{% block content %}
<div class="trade-details-container">
    <div class="trade-details-header">
        <h1>Trade-in Request #{{ "%03d"|format(trade_item.id) }}</h1>
        <span class="status {{ trade_item.status.lower() }}">
            {{ trade_item.status }}
        </span>
    </div>

    <div class="trade-details-info">
        <div class="info-box">
            <p>Estimated Review</p>
            <span>{{ (trade_item.created_at + timedelta(days=3)).strftime('%d %b %Y') }}</span>
        </div>
        <div class="info-box">
            <p>Delivery Method</p>
            <span>{{ "Drop-off" if trade_item.item_condition in ["Brand New", "Like New"] else "Pick-up" }}</span>
        </div>
    </div>

    <div class="items-section">
        <h2>Items</h2>
        <div class="item-details">
            <div class="item-image">
                <p>No Image Available</p>
            </div>
            <div class="item-info">
                <p><strong>Title:</strong> {{ trade_item.title }}</p>
                <p><strong>Item Type:</strong> {{ trade_item.item_type }}</p>
                <p><strong>Genre:</strong> {{ trade_item.genre }}</p>
                <p><strong>Author:</strong> {{ trade_item.author_artist }}</p>
                <p><strong>ISBN:</strong> {{ trade_item.isbn_or_cat }}</p>
                <p><strong>Condition:</strong> {{ trade_item.item_condition }}</p>
            </div>
        </div>
    </div>

    <!-- Admin Approve/Deny Buttons (Hidden when Approved) -->
    {% if current_user.role_id in [2, 3] and trade_item.status != "Approved" %}
    <div class="admin-actions">
        <a href="{{ url_for('manageTradeins.update_trade_status', trade_id=trade_item.id, status='Approved') }}" 
           class="btn btn-success">Approve</a>
        <a href="{{ url_for('manageTradeins.update_trade_status', trade_id=trade_item.id, status='Rejected') }}" 
           class="btn btn-danger">Reject</a>
    </div>
    {% endif %}

    <!-- Shipping & Payment for Approved Trades -->
    {% if trade_item.status == "Approved" %}
        {% if current_user.role_id in [2, 3] %}
            <!-- Admins see this message on approved trade-ins -->
            <div class="admin-shipping-info">
                <p>Approved. Waiting for customer to submit shipping details.</p>
            </div>
        {% else %}
            <!-- Customers see the shipping & payment form -->
            <div class="shipping-payment-section">
                <h2>Shipping & Payment</h2>
                <form action="{{ url_for('manageTradeins.save_shipping_payment', trade_id=trade_item.id) }}" method="POST">
                    <h3>Drop-off option</h3>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="shipping_option" value="Mail-in"> Mail-in
                        </label>
                        <label>
                            <input type="radio" name="shipping_option" value="In-Store"> In-Store drop-off
                        </label>
                        <label>
                            <input type="radio" name="shipping_option" value="Pick-up"> Pick-Up Service (Shipping: $5.00)
                        </label>
                    </div>
                    
                    <!-- Tracking Number (Only for Mail-in) -->
                    <div id="tracking-number-section" class="hidden">
                        <h3>Tracking Number</h3>
                        <input type="text" name="tracking_number" placeholder="Enter Tracking Number">
                    </div>
                    
                    <!-- Shipping Address (Only for Pick-up) -->
                    <div id="shipping-address-section" class="hidden">
                        <h3>Shipping Address</h3>
                        <input type="text" name="street_address" placeholder="Street Address">
                        <input type="text" name="house_block" placeholder="House / Block No.">
                        <input type="text" name="zip_code" placeholder="Zip or Postal Code">
                        <input type="text" name="contact_number" placeholder="Contact Number">
                    </div>
                    
                    <!-- Payment Information (Shown for all options) -->
                    <div id="payment-section" class="hidden">
                        <h3>Payment Option</h3>
                        <div class="payment-group">
                            <input type="text" name="card_number" placeholder="Card Number">
                            <input type="text" name="card_expiry" placeholder="Expiration Date (MM/YY)">
                            <input type="text" name="card_name" placeholder="Name on Card">
                            <div class="checkbox-container">
                                <input type="checkbox" name="save_payment" id="save-payment">
                                <label for="save-payment">Save my payment information</label>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-success">Submit</button>
                    
        {% endif %}
    {% endif %}

    <!-- Back button -->
    <a href="{{ url_for('manageTradeins.manage_tradeins') }}" class="btn btn-secondary">Back to Dashboard</a>
</div>

{% block scripts %}
<script src="{{ url_for('static', filename='js/tradein/tradeDetails.js') }}"></script>
{% endblock %}

{% endblock %}

