{% extends "dashboard/base.html" %}
{% set active_page = "manage_vouchers" %}
{% block title %}Manage Vouchers{% endblock %}

{% block styles %}
<link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/dashboard/manageVouchers/vouchers.css') }}">
{% endblock %}

{% block headerContent %}
<div class="vouchers__header">
  <h1 id="vouchers__title">Manage Vouchers</h1>
  <a href="{{ url_for('manageVouchers.add_voucher') }}" >Add New Voucher</a>
  <div class="extraPadding"></div>
  <div class="search__wrapper">
    <form method="get" action="{{ url_for('manageVouchers.vouchers_listing') }}">
      <div class="search__container">
        <input
          type="text"
          name="q"
          id="search__bar"
          class="search__bar"
          placeholder="Search by voucher code..."
          value="{{ search_query }}"
          autocomplete="off"
        >
        <button type="submit" class="search__button" id="search__button">
          <i class="fa-solid fa-magnifying-glass"></i>
        </button>
        {% if search_query %}
          <a href="{{ url_for('manageVouchers.vouchers_listing') }}" class="clear__button">
            <i class="fa-solid fa-xmark fa-lg"></i>
          </a>
        {% endif %}
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block content %}
<!-- Include flash validation -->
{% include "components/flashValidation.html" %}

<div class="vouchers">
  <table>
    <thead>
      <tr>
        <th class="voucherId">Voucher ID</th>
        <th class="voucherCode">Code</th>
        <th class="voucherType">Type</th>
        <th class="voucherValue">Value</th>
        <th class="voucherExpiry">Expiry</th>
        <th class="voucherStatus">Status</th>
        <th class="controls"></th>
      </tr>
    </thead>
    {% for voucher in vouchers %}
    <tr>
      <td class="voucherId">{{ voucher.id }}</td>
      <td class="voucherCode">{{ voucher.voucher_code }}</td>
      <td class="voucherType">
        {% if voucher.voucherType_id == 1 %}
          Percentage
        {% elif voucher.voucherType_id == 2 %}
          Fixed Amount
        {% else %}
          Free Shipping
        {% endif %}
      </td>
      <td class="voucherValue">
        {% if voucher.voucherType_id == 1 %}
          {{ voucher.discount_value }}%
        {% elif voucher.voucherType_id == 2 %}
          ${{ "%.2f"|format(voucher.discount_value) }}
        {% else %}
          Free Shipping
        {% endif %}
      </td>
      <td class="voucherExpiry">{{ voucher.expiry_days }} days</td>
      <td class="voucherStatus">
        {{ 'Active' if voucher.is_active else 'Inactive' }}
      </td>
          
      <td class="controls">
        <a href="{{ url_for('manageVouchers.voucher_details', id=voucher.id) }}">
          <i class="fa-solid fa-eye"></i>
        </a>
      </td>
    </tr>
    {% endfor %}
  </table>
</div>

<div class="vouchers__pagination">
  <ul>
    {% if current_page > 1 %}
    <li class="pagePrevious__button"><a href="{{ url_for('manageVouchers.vouchers_listing', page=current_page-1, q=search_query) }}">Previous</a></li>
    {% endif %}
    {% for p in range(1, total_pages + 1) %}
    <li class="{% if p == current_page %}active{% endif %}">
      <a href="{{ url_for('manageVouchers.vouchers_listing', page=p, q=search_query) }}" class="page__button">{{ p }}</a>
    </li>
    {% endfor %}
    {% if current_page < total_pages %}
    <li class="pageNext__button"><a href="{{ url_for('manageVouchers.vouchers_listing', page=current_page+1, q=search_query) }}">Next</a></li>
    {% endif %}
  </ul>
</div>
{% endblock %}